<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robert Kubinec">
<meta name="dcterms.date" content="2024-11-22">

<title>Introduction to Idealstan – idealstan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">idealstan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/saudiwin/idealstan"> <i class="bi bi-github" role="img" aria-label="idealstan GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../vignettes/Package_Introduction.html">Articles</a></li><li class="breadcrumb-item"><a href="../vignettes/Package_Introduction.html">Introduction to Idealstan</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Articles</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/Package_Introduction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Introduction to Idealstan</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/Time_Series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time-Varying Ideal Points</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Reference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/delaware.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">delaware</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/derive_chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">derive_chain</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_estimate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_estimate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_extract-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_extract-idealstan-method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_extract.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_extract</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_make.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_make</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_all_hist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_all_hist</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_compare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_compare</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_cov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_cov</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_irf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_irf</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_legis_dyn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_legis_dyn</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_legis_var.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_legis_var</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_legis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_legis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_ppc-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_ppc-idealstan-method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_ppc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_ppc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_rhats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_rhats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot_sims.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot_sims</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot-idealstan-method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_plot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_post_pred-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_post_pred-idealstan-method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_post_pred.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_post_pred</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_rebuild_mpi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_rebuild_mpi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_sim_coverage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_sim_coverage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_sim_gen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_sim_gen</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_sim_resid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_sim_resid</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/id_sim_rmse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">id_sim_rmse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/idealdata-class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">idealdata-class</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/idealstan-class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">idealstan-class</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/idealstan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">idealstan</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/launch_shinystan-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">launch_shinystan-idealstan-method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/launch_shinystan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">launch_shinystan</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/release_questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">release_questions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/senate114.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">senate114</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/stan_trace-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stan_trace-idealstan-method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/stan_trace.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stan_trace</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/summary-idealstan-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">summary-idealstan-method</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../NEWS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LICENSE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CITATION.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citation</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../vignettes/Package_Introduction.html">Articles</a></li><li class="breadcrumb-item"><a href="../vignettes/Package_Introduction.html">Introduction to Idealstan</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Introduction to Idealstan</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Robert Kubinec </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><em>Note: To report bugs with the package, please file an issue on the <a href="https://github.com/saudiwin/idealstan/issues">Github page</a>.</em></p>
<p><strong>If you use this package, please cite the following:</strong></p>
<p>Kubinec, Robert. “Generalized Ideal Point Models for Time-Varying and Missing-Data Inference”. Working Paper.</p>
<p><strong>Note: At present, <code>idealstan</code> uses the <code>cmdstanr</code> package, which is not on CRAN and must be installed separately. Please see below for instructions.</strong></p>
<p>This package implements IRT (item response theory) ideal point models, which are models designed for situations in which actors make strategic choices that correlate with a unidimensional scale, such as the left-right axis in American politics, disagreement over product design in consumer choice, or psychometric scales in which the direction that items load on the latent scale is unknown. Compared to traditional IRT, ideal point models examine the polarizing influence of a set of items on a set of persons, and has similarities to models based on Euclidean latent spaces, such as multi-dimensional scaling. In fact, this package also implements a version of the latent space model for binary outcomes, which is an alternate formulation of an ideal point model.</p>
<p>The goal of <code>idealstan</code> is to offer a wide variety of ideal point models that can model missing-data, time-varying ideal points, and incorporate a range of outcomes, including binary outcomes, counts, continuous and ordinal responses. In addition, <code>idealstan</code> uses the Stan estimation engine to offer full and variational Bayesian inference for all models so that every model is estimated with uncertainty. Variational inference provides a means to estimate Bayesian models on very large data sets when full Bayesian estimation is impractical. The package also exploits variational inference to automatically identify models instead of requiring users to pre-specify which persons or items in the data to constrain in advance.</p>
<p>However, variational inference can fail and it is difficult to diagnose when it will do so. For that reason, the preferred approach is to use full MCMC inference with multiple computer cores per chain to permit parallel processing (explained below) when there is a need to speed up computation. Variational inference should only be used for exploratory analysis or when there are no other alternatives.</p>
<p>The approach to handling missing data in this package is to model directly strategic censoring in observations. This particular version was developed to account for legislatures in which legislators (persons) are strategically absent for votes on bills (items), but it applies to any social choice situation in which actors’ failure to respond to an item may be a function of their ideal point. This approach to missing data can be usefully applied to many contexts in which a missing outcome is a function of the person’s ideal point (i.e., people will tend to be present in the data when the item is far away or very close to their ideal point). If missingness does not appear to arise as a function of ideal points, the models will still incorporate missing data but will assume it is essentially random.</p>
<p>The package includes the following models:</p>
<ol type="1">
<li>IRT 2-PL (binary response) ideal point model, no missing-data inflation</li>
<li>IRT 2-PL ideal point model (binary response) with missing- inflation</li>
<li>Ordinal IRT (rating scale) ideal point model no missing-data inflation</li>
<li>Ordinal IRT (rating scale) ideal point model with missing-data inflation</li>
<li>Ordinal IRT (graded response) ideal point model no missing-data inflation</li>
<li>Ordinal IRT (graded response) ideal point model with missing-data inflation</li>
<li>Poisson IRT (Wordfish) ideal point model with no missing data inflation</li>
<li>Poisson IRT (Wordfish) ideal point model with missing-data inflation</li>
<li>Continuous (Gaussian) IRT ideal point model with no missing data</li>
<li>Continuous (Gaussian) IRT ideal point model with missing-data inflation</li>
<li>Positive-Continuous (Log-normal) IRT ideal point model with no missing data</li>
<li>Positive-Continuous (Log-normal) IRT ideal point model with missing-data inflation</li>
<li>Latent Space (binary response) ideal point model with no missing data</li>
<li>Latent Space (binary response) ideal point model with missing-data inflation</li>
</ol>
<p>In addition, all of these models can be estimated with either time-varying or static ideal points if a column of dates for each item is passed to the model function. This package implements the standard time-varying ideal point model by Martin and Quinn (2002) in which ideal points follow a random walk, i.e., in each time period the ideal points can jump in a random direction. In addition, I have implemented a stationary AR(1) ideal point process for situations in which the random walk model does not appropriately reflect over-time change in ideal points. For more information, please see the vignette about time-varying models.</p>
<p>The package also has extensive plotting functions via <code>ggplot2</code> for model parameters, particularly the legislator (person) ideal points (ability parameters).</p>
<p>This vignette demonstrates basic usage of the package. I first show some crucial installation pre-requisities.</p>
<section id="installation-instructions" class="level2">
<h2 class="anchored" data-anchor-id="installation-instructions">Installation Instructions</h2>
<p>To use <code>idealstan</code>, you first have to have both <code>cmdstanr</code>, an R package, installed and <code>cmdstan</code>, the underlying MCMC library. Unfortunately, <code>cmdstanr</code> is not yet available on CRAN, but you can read complete installation instructions on this page: https://mc-stan.org/cmdstanr/articles/cmdstanr.html.</p>
<p>Assuming you install <code>cmdstan</code> using the functions provided in the package, please allow it to install in the default location. Otherwise you will always have to pass the path of the <code>cmdstan</code> installation to <code>id_estimate</code>.</p>
</section>
<section id="simulation-of-ordinal-irt-with-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="simulation-of-ordinal-irt-with-missing-data">Simulation of Ordinal IRT with Missing Data</h2>
<p>To begin with, we can simulate data from an ordinal ideal-point model in which there are three possible responses corresponding to a legislator voting: yes, abstain and no. An additional category is also simulated that indicates whether a legislator shows up to vote or is absent, which traditional IRT models would record as missing data and would drop from the estimation. This package can instead utilize missing data via a hurdle model in which the censoring of the vote/score data is estimated as a function of individual item/bill intercepts and discrimination parameters for the decision to be absent or present. In other words, if the missing data is a reflection of the person’s ideal point, such as more conservative legislators refusing to show up to vote, than the model will make use of this missing data to infer additional information about the legislators’ ideal points.</p>
<p>The function <code>id_sim_gen()</code> allows you to simulate data from any of the fourteen models currently implemented in <code>idealstan</code> (see previous list). To include missing data, specify the <code>inflate</code> option as <code>TRUE</code>. For example, here we sample data from an ordinal graded response model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ord_ideal_sim <span class="ot">&lt;-</span> <span class="fu">id_sim_gen</span>(<span class="at">model=</span><span class="st">'ordinal_grm'</span>,<span class="at">inflate =</span> T)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">as_data_frame</span>(<span class="fu">head</span>(ord_ideal_sim<span class="sc">@</span>score_matrix)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">item_id</th>
<th style="text-align: left;">person_id</th>
<th style="text-align: left;">model_id</th>
<th style="text-align: left;">group_id</th>
<th style="text-align: right;">time_id</th>
<th style="text-align: left;">outcome_disc</th>
<th style="text-align: right;">ordered_id</th>
<th style="text-align: right;">person_x</th>
<th style="text-align: right;">itemcov0</th>
<th style="text-align: right;">itemcovmiss0</th>
<th style="text-align: right;">discrete</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">missing</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">missing</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Missing</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">missing</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">missing</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Missing</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">missing</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Missing</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">missing</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Missing</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The vote/score matrix in the <code>idealdata</code> object <code>ord_ideal_sim</code> has legislators/persons in the rows and bills/items in the columns. The <code>outcome_disc</code> column has the simulated 3-category ordered outcome.</p>
<p>The function <code>id_estimate</code> will take this processed data and run an IRT ideal point model. To specify the model type, simply include the number of the model in the <code>id_estimate</code> function. It is also possible to have multiple outcome types in a given model, which requires passing the <code>model_id</code> option in the <code>id_make</code> function with a given model number per item in the data. The package also includes the ability to incorporate hierarchical (person or item-level) covariates, as discussed below.</p>
<p>To speed up processing, all of the models in this vignette make use of multiple core parallel computation. To use this option, the specified number of available cores in the <code>ncores</code> option must exceed the number of MCMC chains <code>nchains</code>. <code>cmdstanr</code> will automatically assign cores by dividing the number of chains by the number of cores. In all of the examples in this vignette, I use a machine with 16 cores and estimate 2 chains, so there are 8 cores per chain. By default, <code>id_estimate</code> parallelizes over persons, although that can be changed to items with the <code>map_over_id</code> option (only works with static models).</p>
<p>The package has options for identification that are similar to other IRT packages in which the IDs of legislators/persons to constrain are specified to the <code>id_estimate</code> function. For example, we can use the true values of the simulated legislators to constrain one legislator/person with the highest simulated ideal point and one legislator/person with the lowest ideal point. Each constrained parameter must be fixed to a specific value, preferably at either end of the ideal point spectrum, to identify the model. In particular, two pieces of information are necessary: a value for the high ideal point, and the difference between the high and low points. In this example I pre-specify which parameters to constrain based on the simulated data, and leave the pinned values at their defaults, which are +1 and -1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>true_legis <span class="ot">&lt;-</span> ord_ideal_sim<span class="sc">@</span>simul_data<span class="sc">$</span>true_person</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>high_leg <span class="ot">&lt;-</span> <span class="fu">sort</span>(true_legis,<span class="at">decreasing =</span> <span class="cn">TRUE</span>,<span class="at">index.return=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>low_leg <span class="ot">&lt;-</span> <span class="fu">sort</span>(true_legis,<span class="at">index.return=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>ord_ideal_est <span class="ot">&lt;-</span> <span class="fu">id_estimate</span>(<span class="at">idealdata=</span>ord_ideal_sim,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">model_type=</span><span class="dv">6</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fixtype=</span><span class="st">'prefix'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">restrict_ind_high =</span> <span class="fu">as.character</span>(high_leg<span class="sc">$</span>ix[<span class="dv">1</span>]),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">restrict_ind_low=</span><span class="fu">as.character</span>(low_leg<span class="sc">$</span>ix[<span class="dv">1</span>]),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fix_high =</span> <span class="fu">sort</span>(true_legis,<span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>],</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fix_low =</span> <span class="fu">sort</span>(true_legis,<span class="at">decreasing =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>],</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">id_refresh=</span><span class="dv">500</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ncores=</span><span class="dv">8</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nchains=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running pathfinder to find starting values"
Path [1] :Initial log joint density = -1342.673293 
Path [1] : Iter      log prob        ||dx||      ||grad||     alpha      alpha0      # evals       ELBO    Best ELBO        Notes  
            128      -6.806e+02      7.044e-04   4.193e-03    1.000e+00  1.000e+00      3201 -8.910e+02 -8.910e+02                   
Path [1] :Best Iter: [8] ELBO (-869.800307) evaluations: (3201) 
Finished in  0.5 seconds.
[1] "Estimating model with full Stan MCMC sampler."</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Init values were only set for a subset of parameters. 
Missing init values for the following parameters:
 - chain 1: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw
 - chain 2: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw

To disable this message use options(cmdstanr_warn_inits = FALSE).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 2 parallel chains, with 4 thread(s) per chain...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -26.066, but should be greater than the previous element, -26.066 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is 16.6885, but should be greater than the previous element, 16.6885 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -1.1455, but should be greater than the previous element, -1.1455 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -3.16394, but should be greater than the previous element, -3.16394 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -1.48503, but should be greater than the previous element, -1.48503 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -14.0103, but should be greater than the previous element, -14.0103 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 18.3 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 18.6 seconds.

Both chains finished successfully.
Mean chain execution time: 18.4 seconds.
Total execution time: 18.6 seconds.</code></pre>
</div>
</div>
<p>We can then check and see how well the Stan estimation engine was able to capture the “true” values used in the simulation by plotting the true ideal points relative to the estimated ones:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id_plot_legis</span>(ord_ideal_est,<span class="at">show_true =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id_num)`
Joining with `by = join_by(id_num)`</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/check_true-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Given the small amount of data used to estimate the model, the imprecision with which the ideal points were recovered is not surprising.</p>
<p>To automatically identify the model, simply change the <code>fixtype</code> option to <code>'vb_full'</code>. By default, the model will select the highest and lowest ideal points to constrain by running an approximation to the full posterior using <code>cmdstanr</code>’s <code>pathfinder()</code> function. While this method works, the exact rotation is not known a priori, and so it may produce a different result with multiple runs. Note that there will be two <code>pathfinder</code> runs as the first run identifies the parameters to constrain and the second is used to create starting values for the Hamiltonian Monte Carlo estimation.</p>
<p>For example, using our simulated data and identifying the model automatically with <code>'vb_full'</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ord_ideal_est <span class="ot">&lt;-</span> <span class="fu">id_estimate</span>(<span class="at">idealdata=</span>ord_ideal_sim,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">model_type=</span><span class="dv">6</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">id_refresh=</span><span class="dv">2000</span>,<span class="at">fixtype=</span><span class="st">"vb_full"</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ncores=</span><span class="dv">8</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nchains=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(First Step): Estimating model with Pathfinder (variational inference) to identify modes to constrain."
Path [1] :Initial log joint density = -1776.866082 
Path [1] : Iter      log prob        ||dx||      ||grad||     alpha      alpha0      # evals       ELBO    Best ELBO        Notes  
             82      -6.962e+02      1.119e-03   2.086e-03    1.000e+00  1.000e+00      2051 -8.258e+02 -8.258e+02                   
Path [1] :Best Iter: [81] ELBO (-822.576092) evaluations: (2051) 
Finished in  0.4 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running pathfinder to find starting values"
Path [1] :Initial log joint density = -1277.419371 
Path [1] : Iter      log prob        ||dx||      ||grad||     alpha      alpha0      # evals       ELBO    Best ELBO        Notes  
            142      -6.804e+02      1.046e-03   4.382e-03    9.299e-01  9.299e-01      3551 -9.032e+02 -9.032e+02                   
Path [1] :Best Iter: [4] ELBO (-852.263399) evaluations: (3551) 
Finished in  0.5 seconds.
[1] "Estimating model with full Stan MCMC sampler."</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Init values were only set for a subset of parameters. 
Missing init values for the following parameters:
 - chain 1: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw
 - chain 2: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw

To disable this message use options(cmdstanr_warn_inits = FALSE).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 2 parallel chains, with 4 thread(s) per chain...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -11.7372, but should be greater than the previous element, -11.7372 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is 59.7902, but should be greater than the previous element, 59.7902 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: Exception: ordered_logistic: Cut-points is not a valid ordered vector. The element at 2 is -8.43665, but should be greater than the previous element, -8.43665 (in '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/model_types_mm_map_persons.stan', line 378, column 6, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/idealstan/stan_files//chunks/map_func.stan', line 401, column 0, included from</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 45, column 0) (in '/var/folders/4d/m4b3zyn966d7ctnd4hz4zvfh0000gs/T/Rtmp7rBptZ/model-1575a27f0eea7.stan', line 632, column 2 to line 735, column 20)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 17.2 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 17.3 seconds.

Both chains finished successfully.
Mean chain execution time: 17.2 seconds.
Total execution time: 17.4 seconds.</code></pre>
</div>
</div>
<p>We can see from the plot of the Rhats, which is an MCMC convergence diagnostic, that all the Rhats are below 1.1, which is a good (though not perfect) sign that the model is fully identified:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id_plot_rhats</span>(ord_ideal_est)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/rhats-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id_plot_legis</span>(ord_ideal_est,<span class="at">show_true =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id_num)`
Joining with `by = join_by(id_num)`</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/rhats-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>In general, it is always a good idea to check the Rhats before proceeding with further analysis. Identification of time-varying ideal point models can be more complicated and is discussed in the accompanying vignette. As can be seen above, while the Pathfinder algorithm can identify a mode, it may not be the mode that is theoretically interesting.</p>
</section>
<section id="empirical-example-u.s.-senate" class="level1">
<h1>Empirical Example: U.S. Senate</h1>
<p>This package was developed for datasets that are in a long format, i.e., one row per person/legislator, item/bill, and any other covariate. This data format departs from the traditional way of storing/using IRT/ideal point data, which is more commonly stored in a wide format with legislators/persons in the rows and items/bills in the columns.</p>
<p>To demonstrate how the package functions empirically, I include in the package a partial voting record of the 114th Senate (excluding rollcall votes without significant disagreement) from the website <a href="http://www.voteview.com">www.voteview.com</a>. We can convert this data, which is provided in a long data frame, to an <code>idealdata</code> object suitable for estimation by using the <code>id_make</code> function. Because the intention is to fit a binary outcome model (yes or no votes on bills), I recode the outcome to be 0 for no votes and 1 for yes votes as <code>idealstan</code> expects binary outcomes to be coded this way.</p>
<p>We can first take a look at the raw data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">'senate114'</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">select</span>(<span class="fu">head</span>(senate114),<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 39%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">bioname</th>
<th style="text-align: right;">born</th>
<th style="text-align: left;">party_code</th>
<th style="text-align: right;">rollnumber</th>
<th style="text-align: left;">date</th>
<th style="text-align: left;">cast_code</th>
<th style="text-align: right;">congress</th>
<th style="text-align: left;">chamber</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SESSIONS, Jefferson Beauregard III (Jeff)</td>
<td style="text-align: right;">1946</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">2015-01-20</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Senate</td>
</tr>
<tr class="even">
<td style="text-align: left;">SESSIONS, Jefferson Beauregard III (Jeff)</td>
<td style="text-align: right;">1946</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">2015-01-20</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Senate</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SESSIONS, Jefferson Beauregard III (Jeff)</td>
<td style="text-align: right;">1946</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">2015-01-21</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Senate</td>
</tr>
<tr class="even">
<td style="text-align: left;">SESSIONS, Jefferson Beauregard III (Jeff)</td>
<td style="text-align: right;">1946</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">2015-01-21</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Senate</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SESSIONS, Jefferson Beauregard III (Jeff)</td>
<td style="text-align: right;">1946</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">2015-01-21</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Senate</td>
</tr>
<tr class="even">
<td style="text-align: left;">SESSIONS, Jefferson Beauregard III (Jeff)</td>
<td style="text-align: right;">1946</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">2015-01-21</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">114</td>
<td style="text-align: left;">Senate</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(senate114<span class="sc">$</span>cast_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    No    Yes Absent 
 11233  12119    648 </code></pre>
</div>
</div>
<p>First, you can see that the data are in long form because there is one row for every vote cast by a legislator, in this case Senator Sessions. The outcome variable is <code>cast_code</code>. This variable is coded as a factor variable with the levels in the order we would want for a binary outcome, i.e, <code>'No'</code> is before <code>'Yes'</code>. Each item in the model is a recorded vote in the Senate, the numbers of which are listed in column <code>rollnumber</code>. We also know the dates of the individual items (rollcalls), which we will use in the time-varying ideal point vignette to model time-varying ideal points.</p>
<p>The table shows that there are roughly twice as many yes votes versus no votes, with a small minority of absences. In this case, absences can be counted as missing data.</p>
<p>To create an <code>idealdata</code> object for modeling from our long data frame, we pass it to the <code>id_make</code> function and specify the names of the columns that correspond to person IDs, item IDs, group IDs (i.e., party), time IDs and the outcome, although only person, item and outcome are required for the function to work for a static model. Because this is a discrete model, we pass the column name for the outcome to the <code>outcome_disc</code> argument. If we also had continuous models and data, we would need to specify the <code>model_id</code> column with the correct model number (see table above) and put all continuous (real) data in a separate column which we could pass to the <code>outcome_cont</code> argument.</p>
<p>Note that all missing data should be coded as NA before passing it to <code>id_make</code>.</p>
<p>There are many other columns in the <code>senate114</code> data. These can be used as person or item/bill covariates, as is discussed at the end of the vignette, but are essentially ignored unless specified to the <code>id_make</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set missing (Absent) to NA</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>senate114<span class="sc">$</span>cast_code <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(senate114<span class="sc">$</span>cast_code<span class="sc">==</span><span class="st">"Absent"</span>,<span class="cn">NA</span>,senate114<span class="sc">$</span>cast_code)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># recode outcome to 0/1</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>senate114<span class="sc">$</span>cast_code <span class="ot">&lt;-</span> senate114<span class="sc">$</span>cast_code <span class="sc">-</span>  <span class="dv">1</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>senate_data <span class="ot">&lt;-</span> <span class="fu">id_make</span>(senate114,<span class="at">outcome_disc =</span> <span class="st">'cast_code'</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">person_id =</span> <span class="st">'bioname'</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">item_id =</span> <span class="st">'rollnumber'</span>,</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group_id=</span> <span class="st">'party_code'</span>,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">time_id=</span><span class="st">'date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then run a binary IRT ideal point model in which absences on particular bills are treated as a “hurdle” that the legislator must overcome in order to show up to vote. To do so, we specify <code>model_type=2</code>, which signifies a binary IRT model with missing-data (absence) inflation (see list above). In essence, the model is calculating a separate ideal point position for each bill/item that represents the bill’s importance to different senators. Only if a bill is relatively salient will a legislator choose to show up and vote.</p>
<p>This same missing-data mechanism also applies more broadly to situations of social choice. Any time that missing data might be a function of ideal points–people with certain ideal points are likely to avoid giving an answer–then these values should be marked as <code>NA</code> in the data and an inflated model type should be used.</p>
<!-- Because this dataset is relatively large, we will use the `use_vb` option to use Stan's variational Bayesian inference. This version of the sampler is less accurate and tends to underestimate uncertainty, but it runs much, much faster. Generally speaking, the values of the ideal points are close to the full posterior, and it is useful for exploratory model-building even with small datasets. For very large data, `use_vb` is the only viable option as estimation times may require days or longer.  -->
<p>Ideal points are not identified without further information about the latent scale, especially its direction: should conservative ideal points be listed as positive or negative? To identify the latent scale, I constrain a conservative senator (John Barrasso) to be positive, and a liberal senator, Elizabeth Warren, to be negative in order to identify the polarity in the model. I have to pass in the names of the legislators as they exist in the IDs present in the <code>senate114</code> data (column <code>bionames</code>). The person ideal point parameters are pinned to +1 and -1 but these values can be changed with the <code>fix_high</code> and <code>fix_low</code> function arguments for <code>id_estimate</code>.</p>
<p>It is important to note that the model can also be identified by fixing item (bill) discrimination parameters by setting the <code>const_type</code> argument to <code>"items"</code>. Then the values for <code>restrict_ind_high</code> and <code>restrict_ind_low</code> should be set to the character values of names for items in the data. Identifying the model based on item discrimination can have some excellent properties as it leaves all of the person ideal points to float. It is also very useful with time-varying models where fixing person ideal points can be very challenging.</p>
<!-- Rather than specify the exact values to pin the legislators to, I set `fixtype` to `'vb_partial'` so that the function will first fit an un-identified model, and then use those estimates to determine what would be good values to pin these legislators to. Using `'vb_partial'` is the recommended way to identify models while using prior information about the direction of the latent scale as it avoids having to fix these ideal points to specific values. It will also create starting values for the ideal points that should speed convergence.  -->
<p>To make the model fit faster, I set <code>nchains</code> at 2 and <code>ncores</code> at 16, which will allow for 8 cores to be used per chain for parallel processing (assuming of course the computer has access to 16 cores).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>sen_est <span class="ot">&lt;-</span> <span class="fu">id_estimate</span>(senate_data,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">model_type =</span> <span class="dv">1</span>,<span class="at">ncores=</span><span class="dv">8</span>,<span class="at">nchains=</span><span class="dv">2</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">fixtype=</span><span class="st">'prefix'</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">restrict_ind_high =</span> <span class="st">"WARREN, Elizabeth"</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">restrict_ind_low=</span><span class="st">"BARRASSO, John A."</span>,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed=</span><span class="dv">84520</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running pathfinder to find starting values"
Finished in  3.8 seconds.
[1] "Estimating model with full Stan MCMC sampler."</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Init values were only set for a subset of parameters. 
Missing init values for the following parameters:
 - chain 1: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm3, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw
 - chain 2: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm3, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw

To disable this message use options(cmdstanr_warn_inits = FALSE).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 2 parallel chains, with 4 thread(s) per chain...

Chain 2 finished in 124.2 seconds.
Chain 1 finished in 125.4 seconds.

Both chains finished successfully.
Mean chain execution time: 124.8 seconds.
Total execution time: 125.5 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id_plot_legis</span>(sen_est,<span class="at">person_ci_alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">D=</span><span class="st">'blue'</span>,<span class="at">R=</span><span class="st">'red'</span>,<span class="at">I=</span><span class="st">'green'</span>)) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Ideal Points of the 114th Senate'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id_num)`</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/run_114_model-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The <code>id_plot</code> function has many other options which are documented in the help files. One notable option, though, is to plot bill midpoints along with the legislator ideal points. The midpoints show the line of equiprobability, i.e., at what ideal point is a legislator with that ideal point indifferent to voting on a bill (or answering an item correctly). To plot a bill midpoint overlay, simply include the character ID of the bill (equivalent to the column name of the bill in the rollcall vote matrix) as the <code>item_plot</code> option:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id_plot_legis</span>(sen_est,<span class="at">person_ci_alpha=</span><span class="fl">0.1</span>,<span class="at">item_plot=</span><span class="st">'94'</span>) <span class="sc">+</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">D=</span><span class="st">'blue'</span>,<span class="at">R=</span><span class="st">'red'</span>,<span class="at">I=</span><span class="st">'green'</span>)) <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Ideal Points of the 114th Senate with Vote 94 Midpoint'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id_num)`</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/item_plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The 50th bill in the 114 Senate shows very high discrimination: the bill midpoint is right in the middle of the ideal point distribution, with most Democrats voting yes and most Republicans voting no. The two rug lines at the bottom of the plot show the high density posterior interval for the bill midpoint, and as can be seen, the uncertainty only included those legislators near the very center of the distribution.</p>
<p>To look at the bill’s absence midpoints, simply change the <code>item_plot_type</code> parameter to the <code>id_plot</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id_plot</span>(sen_est,<span class="at">person_ci_alpha=</span><span class="fl">0.1</span>,<span class="at">item_plot=</span><span class="st">'225'</span>,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">item_plot_type=</span><span class="st">'inflated'</span>) <span class="sc">+</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">D=</span><span class="st">'blue'</span>,<span class="at">R=</span><span class="st">'red'</span>,<span class="at">I=</span><span class="st">'green'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id_num)`</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/abs_item_plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The wide high-posterior density (HPD) interval of the absence midpoint ruglines shows that absences are very uninformative of ideal points for this particular bill (as is common in the Senate where absences are very rare).</p>
<section id="parameter-values" class="level2">
<h2 class="anchored" data-anchor-id="parameter-values">Parameter Values</h2>
<p>We can obtain summary estimates of all the ideal points and item/bill discrimination/difficulty parameters using the summary function that provides the median value of the parameters in addition to a specified posterior density interval (i.e., 5%-95%). For example, we can extract summaries for the ideal points:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>ideal_pts_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(sen_est,<span class="at">pars=</span><span class="st">'ideal_pts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id_num)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ideal_pts_sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 19%">
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Person</th>
<th style="text-align: left;">Group</th>
<th style="text-align: right;">Time_Point</th>
<th style="text-align: right;">Low Posterior Interval</th>
<th style="text-align: right;">Posterior Median</th>
<th style="text-align: right;">High Posterior Interval</th>
<th style="text-align: left;">Parameter Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">WYDEN, Ronald Lee</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.357603</td>
<td style="text-align: right;">7.693815</td>
<td style="text-align: right;">9.328187</td>
<td style="text-align: left;">L_full[100]</td>
</tr>
<tr class="even">
<td style="text-align: left;">BOXER, Barbara</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.192740</td>
<td style="text-align: right;">8.864315</td>
<td style="text-align: right;">11.145765</td>
<td style="text-align: left;">L_full[10]</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BROWN, Sherrod</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.743163</td>
<td style="text-align: right;">9.604320</td>
<td style="text-align: right;">12.162100</td>
<td style="text-align: left;">L_full[11]</td>
</tr>
<tr class="even">
<td style="text-align: left;">BURR, Richard M.</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-6.929614</td>
<td style="text-align: right;">-5.999620</td>
<td style="text-align: right;">-5.127497</td>
<td style="text-align: left;">L_full[12]</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CANTWELL, Maria E.</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.356876</td>
<td style="text-align: right;">9.024715</td>
<td style="text-align: right;">11.223125</td>
<td style="text-align: left;">L_full[13]</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAPITO, Shelley Moore</td>
<td style="text-align: left;">R</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-6.081596</td>
<td style="text-align: right;">-5.252120</td>
<td style="text-align: right;">-4.433251</td>
<td style="text-align: left;">L_full[14]</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>Parameter Name</code> is the name of the parameter in the underlying Stan code, which can be useful f you want to peruse the fitted Stan model (and can be accessed as given in the code below). The name of the parameters for ideal points in the Stan model is <code>L_full</code> (as seen in the summary from above).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>stan_obj <span class="ot">&lt;-</span> sen_est<span class="sc">@</span>stan_samples</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># show the </span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>stan_obj<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"L_full[1]"</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'L_full[2]'</span>,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'L_full[3]'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_array: 1000 iterations, 2 chains, and 3 variables
, , variable = L_full[1]

         chain
iteration    1    2
        1 -3.9 -4.0
        2 -3.8 -3.9
        3 -3.8 -4.3
        4 -4.6 -4.0
        5 -4.0 -4.5

, , variable = L_full[2]

         chain
iteration    1    2
        1 -2.3 -2.2
        2 -2.5 -2.2
        3 -1.9 -2.4
        4 -2.3 -2.1
        5 -2.5 -2.8

, , variable = L_full[3]

         chain
iteration    1   2
        1  8.7 6.7
        2  8.7 7.0
        3  9.0 9.2
        4  9.0 7.1
        5 10.0 9.8

# ... with 995 more iterations</code></pre>
</div>
</div>
<p>If we know the name of the Stan parameter, we can look at the trace plot to see how the quality of the Markov Chain Monte Carlo (MCMC) sampling used to fit the model. A good trace plot shows a bouncy line that is stable around an average value. For more info, see the <a href="http://mc-stan.org/users/documentation/case-studies/rstan_workflow.html">Stan documentation</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stan_trace</span>(sen_est,<span class="at">par=</span><span class="st">'L_full[1]'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/stan_trace-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Finally we can also extract all of the posterior iterations to do additional calculations that average over posterior uncertainty by changing the <code>aggregate</code> option in <code>summary</code>. In the following code, I access the individual posterior iterations for the item/bill parameters, including difficulty (average probability of voting yes), discrimination (how strongly the item/bill loads on either end of the ideal point scale) and the midpoints (position where someone with that ideal point would be indifferent to voting yes/no).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>item_all <span class="ot">&lt;-</span> <span class="fu">summary</span>(sen_est,<span class="at">pars=</span><span class="st">'items'</span>, <span class="at">aggregate=</span>F)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(item_all))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 15%">
<col style="width: 27%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Posterior_Sample</th>
<th style="text-align: left;">Item Name</th>
<th style="text-align: left;">Item Type</th>
<th style="text-align: left;">Predicted Outcome</th>
<th style="text-align: left;">Parameter</th>
<th style="text-align: right;">Iteration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2.698639</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Non-Inflated Item Midpoint</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">A function of other parameters</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.638652</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Non-Inflated Item Midpoint</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">A function of other parameters</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.824350</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Non-Inflated Item Midpoint</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">A function of other parameters</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.351416</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Non-Inflated Item Midpoint</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">A function of other parameters</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.563152</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Non-Inflated Item Midpoint</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">A function of other parameters</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.104156</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Non-Inflated Item Midpoint</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">A function of other parameters</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="hierarchical-covariates" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-covariates">Hierarchical Covariates</h2>
<p><em>Note: ideal point marginal effects have yet to be implemented as a separate function. In this section I demonstrate how to estimate these effects using R code.</em></p>
<p>Finally, we can also fit a model where we include a covariate that varies by person/legislator. To do so, we need to pass a one-sided formula to the <code>id_make</code> function to prepare the data accordingly. By way of example, we will include a model where we include an interaction between party ID (<code>party_code</code>) and the legislator’s age to see if younger/older legislators are more or less conservative. Because this is a static model, the effect of the covariate is averaged over all of the bills in the dataset and all the legislators in the dataset without taking into account the order or time period of the bills.</p>
<p><strong>It is important to note that for static ideal point models, covariates are only defined over the legislators/persons who are not being used as constraints in the model, such as John Barasso and Elizabeth Warren in this model.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>senate114<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="dv">2018</span> <span class="sc">-</span> senate114<span class="sc">$</span>born</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># center the variable</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>senate114<span class="sc">$</span>age <span class="ot">&lt;-</span> senate114<span class="sc">$</span>age <span class="sc">-</span> <span class="fu">mean</span>(senate114<span class="sc">$</span>age)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># put in units of 10 years</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>senate114<span class="sc">$</span>age <span class="ot">&lt;-</span> senate114<span class="sc">$</span>age <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># doing this will improve estimation speed (variables mean-centered and with an SD</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co"># not much bigger than 1 or 2)</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>senate_data <span class="ot">&lt;-</span> <span class="fu">id_make</span>(senate114,<span class="at">outcome_disc =</span> <span class="st">'cast_code'</span>,</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">person_id =</span> <span class="st">'bioname'</span>,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">item_id =</span> <span class="st">'rollnumber'</span>,</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group_id=</span> <span class="st">'party_code'</span>,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">time_id=</span><span class="st">'date'</span>,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">person_cov =</span> <span class="sc">~</span>party_code<span class="sc">*</span>age)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>sen_est_cov <span class="ot">&lt;-</span> <span class="fu">id_estimate</span>(senate_data,</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">model_type =</span> <span class="dv">1</span>,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">fixtype=</span><span class="st">'prefix'</span>,</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">nchains=</span><span class="dv">2</span>,</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span><span class="dv">8</span>,</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">restrict_ind_high =</span> <span class="st">"BARRASSO, John A."</span>,</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">restrict_ind_low=</span><span class="st">"WARREN, Elizabeth"</span>,</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed=</span><span class="dv">84520</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running pathfinder to find starting values"
Finished in  6.1 seconds.
[1] "Estimating model with full Stan MCMC sampler."</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Init values were only set for a subset of parameters. 
Missing init values for the following parameters:
 - chain 1: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm3, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw
 - chain 2: m_sd_free, gp_sd_free, ls_int, ls_int_abs, L_tp1_var, L_AR1, steps_votes3, steps_votes4, steps_votes5, steps_votes6, steps_votes7, steps_votes8, steps_votes9, steps_votes10, steps_votes_grm3, steps_votes_grm4, steps_votes_grm5, steps_votes_grm6, steps_votes_grm7, steps_votes_grm8, steps_votes_grm9, steps_votes_grm10, extra_sd, time_var_gp_free, time_var_free, a_raw

To disable this message use options(cmdstanr_warn_inits = FALSE).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 2 parallel chains, with 4 thread(s) per chain...

Chain 2 finished in 245.6 seconds.
Chain 1 finished in 246.1 seconds.

Both chains finished successfully.
Mean chain execution time: 245.8 seconds.
Total execution time: 246.3 seconds.</code></pre>
</div>
</div>
<p>As discussed in the associated working paper (https://osf.io/preprints/osf/8j2bt), ideal point marginal effects can be derived from <code>idealstan</code> models in which the raw relationship between the hierarchical covariates and the actual outcomes (in this case, votes) can be shown at the item (vote) level. At present, this feature is not yet implemented in a function, but it can be calculated using code as shown below for a given covariate. In this case, we will look at the marginal effect of age on votes conditional on party affiliation. To do so, we will extract the hierarchical covariate effects from the underlying <code>cmdstanr</code> model and then use the <code>id_post_pred</code>, which allows us to predict the outcome given new data, to calculate the effects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First make two new datasets that have different values for age</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># difference is quite small (0.001)</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This is for numerical differentiation as described in the working paper</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to begin with our original dataset that we passed to the id_make function</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parameter for the change we will calculate, just needs to be very small</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> <span class="fl">1e-5</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  new_data1 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(senate114,</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">age =</span> age <span class="sc">-</span> eps <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>  new_data2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(senate114,</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">age =</span> age <span class="sc">+</span> eps <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now predict new outcome distributions given these slightly different datasets</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use draws="all" to avoid comparing different draws to each other</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>  sen_mod_pred1 <span class="ot">&lt;-</span> <span class="fu">id_post_pred</span>(sen_est_cov,<span class="at">newdata=</span>new_data1,</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">use_cores=</span><span class="dv">4</span>,</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">draws=</span><span class="st">"all"</span>,</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">type=</span><span class="st">"epred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Processing posterior replications for 23352 scores using all posterior samples out of a total of 2000 samples."
[1] "Adding in hierarchical covariates values to the time-varying person scores."
[1] "Collapsing covariates to person and time IDs."
[1] "Done!"
[1] "Now on model 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>  sen_mod_pred2 <span class="ot">&lt;-</span> <span class="fu">id_post_pred</span>(sen_est_cov,<span class="at">newdata=</span>new_data2,</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">use_cores=</span><span class="dv">4</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">draws=</span><span class="st">"all"</span>,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">type=</span><span class="st">"epred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Processing posterior replications for 23352 scores using all posterior samples out of a total of 2000 samples."
[1] "Adding in hierarchical covariates values to the time-varying person scores."
[1] "Collapsing covariates to person and time IDs."
[1] "Done!"
[1] "Now on model 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now we need to difference the datasets at the item level to calculate the effects</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this will create some lists that will then be appended together to a big data frame</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with one observation per posterior draw</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Looping over items"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Looping over items"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># difference the predictions</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  c1 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map2</span>(sen_mod_pred1[[<span class="dv">1</span>]],</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                    sen_mod_pred2[[<span class="dv">1</span>]],</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">function</span>(small,big) {</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># difference the effects</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>                      (big <span class="sc">-</span> small)<span class="sc">/</span>eps</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine into datasets for each item with item id + person (senator) id</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>  c2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(c1, <span class="cf">function</span>(mat) {</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>    out_data <span class="ot">&lt;-</span> <span class="fu">attr</span>(mat, <span class="st">"data"</span>)</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> out_data<span class="sc">$</span>person_id</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(mat) <span class="sc">%&gt;%</span> </span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">draws=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">item_id=</span><span class="fu">unique</span>(out_data<span class="sc">$</span>item_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gather</span>(<span class="at">key=</span><span class="st">"person_id"</span>,<span class="at">value=</span><span class="st">"estimate"</span>,<span class="sc">-</span>draws,<span class="sc">-</span>item_id) <span class="sc">%&gt;%</span> </span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">person_id=</span><span class="fu">as.numeric</span>(person_id),</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate=</span><span class="fu">as.numeric</span>(estimate))</span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> bind_rows</span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># merge in some original data</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>  to_merge <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sen_est_cov<span class="sc">@</span>score_data<span class="sc">@</span>score_matrix, </span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">item_orig=</span>item_id,</span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">person_orig=</span>person_id,</span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">person_id=</span><span class="fu">as.numeric</span>(person_id),</span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">item_id=</span><span class="fu">as.numeric</span>(item_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(person_id, item_id, group_id,item_orig, person_orig) <span class="sc">%&gt;%</span> </span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>    distinct</span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add in party data so we can calculate party-specific effects</span></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>  c2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(c2, to_merge, </span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"item_id"</span>,<span class="st">"person_id"</span>))</span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get effect separately by each item and party</span></span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first have to aggregate to party level by draw, then take average by item</span></span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a>   by_party <span class="ot">&lt;-</span> <span class="fu">group_by</span>(c2, draws, group_id, item_id, item_orig) <span class="sc">%&gt;%</span> </span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_est1=</span><span class="fu">mean</span>(estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group_id, item_id, item_orig) <span class="sc">%&gt;%</span> </span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_est=</span><span class="fu">mean</span>(mean_est1),</span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a>              <span class="at">low_est=</span><span class="fu">quantile</span>(mean_est1, .<span class="dv">05</span>),</span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a>              <span class="at">high_est=</span><span class="fu">quantile</span>(mean_est1, .<span class="dv">95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'draws', 'group_id', 'item_id'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'group_id', 'item_id'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>   <span class="co"># merge in item discrimination to add some color / show high-discrim votes</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>   item_discrim <span class="ot">&lt;-</span> <span class="fu">filter</span>(sen_est_cov<span class="sc">@</span>summary,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">grepl</span>(<span class="at">x=</span>variable, <span class="at">pattern=</span><span class="st">"sigma</span><span class="sc">\\</span><span class="st">_reg</span><span class="sc">\\</span><span class="st">_free"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">item_id=</span><span class="fu">as.numeric</span>(stringr<span class="sc">::</span><span class="fu">str_extract</span>(variable, <span class="st">"[0-9]+"</span>)))</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>   by_party <span class="ot">&lt;-</span> <span class="fu">left_join</span>(by_party,</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(item_discrim, median, item_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(item_id)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>   <span class="co"># plot the result</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>   by_party <span class="sc">%&gt;%</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_id=</span><span class="fu">factor</span>(group_id,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"D"</span>,<span class="st">"R"</span>,<span class="st">"I"</span>),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Democrats"</span>, <span class="st">"Republicans"</span>,<span class="st">"Independent"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean_est,</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">x=</span><span class="fu">reorder</span>(item_id,mean_est))) <span class="sc">+</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>low_est,</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax=</span>high_est,</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">colour=</span><span class="st">`</span><span class="at">median</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>group_id,<span class="at">scales=</span><span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_tufte</span>() <span class="sc">+</span> </span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_viridis_c</span>(<span class="at">name=</span><span class="st">"Discrimination"</span>) <span class="sc">+</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"Marginal Change in Probability of Voting"</span>,</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">x=</span><span class="st">"Rollcalls"</span>,</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Marginal effect of age on voting on a specific rollcall in the Senate."</span>) <span class="sc">+</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>,<span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_clean</span>() <span class="sc">+</span></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Package_Introduction_files/figure-html/marg_effect-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Because these covariates are on the ideal point scale, the meaning of the scale in terms of party ideology must be kept in mind in order to interpret the plot. The way to interpret these plots is that for Republicans, increasing age is associated with voting for bills that are more conservative, while for Democrats, the opposite is true. In other words, older party members tend to vote for bills that are ideologically more extreme than younger party members, though the relationship is strongest for Republicans vs.&nbsp;others. Keeping the direction of the scale in mind is crucial for understanding hierarchical covariates in ideal point models.</p>
<p>We can also extract the covariate summary values using the <code>summary</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>cov_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(sen_est_cov,<span class="at">pars=</span><span class="st">'person_cov'</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(cov_sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 18%">
<col style="width: 26%">
<col style="width: 25%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Covariate</th>
<th style="text-align: right;">Posterior Median</th>
<th style="text-align: right;">Posterior High Interval</th>
<th style="text-align: right;">Posterior Low Interval</th>
<th style="text-align: left;">Parameter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">party_codeR</td>
<td style="text-align: right;">13.2374500</td>
<td style="text-align: right;">14.4925750</td>
<td style="text-align: right;">12.0704800</td>
<td style="text-align: left;">legis_x</td>
</tr>
<tr class="even">
<td style="text-align: left;">party_codeI</td>
<td style="text-align: right;">-0.9060290</td>
<td style="text-align: right;">5.2187350</td>
<td style="text-align: right;">-6.7975760</td>
<td style="text-align: left;">legis_x</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">-0.6052185</td>
<td style="text-align: right;">0.2418241</td>
<td style="text-align: right;">-1.4583990</td>
<td style="text-align: left;">legis_x</td>
</tr>
<tr class="even">
<td style="text-align: left;">party_codeR:age</td>
<td style="text-align: right;">1.3651700</td>
<td style="text-align: right;">2.4921350</td>
<td style="text-align: right;">0.3082013</td>
<td style="text-align: left;">legis_x</td>
</tr>
<tr class="odd">
<td style="text-align: left;">party_codeI:age</td>
<td style="text-align: right;">-2.3293450</td>
<td style="text-align: right;">3.0728845</td>
<td style="text-align: right;">-7.9937555</td>
<td style="text-align: left;">legis_x</td>
</tr>
</tbody>
</table>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>